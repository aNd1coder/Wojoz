function spellChecker(a){this.popUpUrl="fck_spellerpages/spellerpages/spellchecker.html";this.popUpName="spellchecker";this.popUpProps=null;this.replWordFlag="R";this.ignrWordFlag="I";this.replAllFlag="RA";this.ignrAllFlag="IA";this.fromReplAll="~RA";this.fromIgnrAll="~IA";this.wordFlags=[];this.currentTextIndex=0;this.currentWordIndex=0;this.spellCheckerWin=null;this.controlWin=null;this.wordWin=null;this.textArea=a;this.textInputs=arguments;this._spellcheck=_spellcheck;this._getSuggestions=_getSuggestions;this._setAsIgnored=_setAsIgnored;this._getTotalReplaced=_getTotalReplaced;this._setWordText=_setWordText;this._getFormInputs=_getFormInputs;this.openChecker=openChecker;this.startCheck=startCheck;this.checkTextBoxes=checkTextBoxes;this.checkTextAreas=checkTextAreas;this.spellCheckAll=spellCheckAll;this.ignoreWord=ignoreWord;this.ignoreAll=ignoreAll;this.replaceWord=replaceWord;this.replaceAll=replaceAll;this.terminateSpell=terminateSpell;this.undo=undo;window.speller=this}function checkTextBoxes(){this.textInputs=this._getFormInputs("^text$");this.openChecker()}function checkTextAreas(){this.textInputs=this._getFormInputs("^textarea$");this.openChecker()}function spellCheckAll(){this.textInputs=this._getFormInputs("^text(area)?$");this.openChecker()}function openChecker(){this.spellCheckerWin=window.open(this.popUpUrl,this.popUpName,this.popUpProps);if(!this.spellCheckerWin.opener)this.spellCheckerWin.opener=window}function startCheck(c,b){this.wordWin=c;this.controlWin=b;this.wordWin.resetForm();this.controlWin.resetForm();this.currentTextIndex=0;this.currentWordIndex=0;this.wordFlags=new Array(this.wordWin.textInputs.length);for(var a=0;a<this.wordFlags.length;a++)this.wordFlags[a]=[];this._spellcheck();return true}function ignoreWord(){var b=this.currentWordIndex,a=this.currentTextIndex;if(!this.wordWin){alert("Error: Word frame not available.");return false}if(!this.wordWin.getTextVal(a,b)){alert('Error: "Not in dictionary" text is missing.');return false}if(this._setAsIgnored(a,b,this.ignrWordFlag)){this.currentWordIndex++;this._spellcheck()}return true}function ignoreAll(){var d=this.currentWordIndex,c=this.currentTextIndex;if(!this.wordWin){alert("Error: Word frame not available.");return false}var e=this.wordWin.getTextVal(c,d);if(!e){alert('Error: "Not in dictionary" text is missing');return false}this._setAsIgnored(c,d,this.ignrAllFlag);for(var a=c;a<this.wordWin.textInputs.length;a++)for(var b=0;b<this.wordWin.totalWords(a);b++)if(a==c&&b>d||a>c)this.wordWin.getTextVal(a,b)==e&&!this.wordFlags[a][b]&&this._setAsIgnored(a,b,this.fromIgnrAll);this.currentWordIndex++;this._spellcheck();return true}function replaceWord(){var c=this.currentWordIndex,b=this.currentTextIndex;if(!this.wordWin){alert("Error: Word frame not available.");return false}if(!this.wordWin.getTextVal(b,c)){alert('Error: "Not in dictionary" text is missing');return false}if(!this.controlWin.replacementText)return false;var a=this.controlWin.replacementText;if(a.value){var d=new String(a.value);if(this._setWordText(b,c,d,this.replWordFlag)){this.currentWordIndex++;this._spellcheck()}}return true}function replaceAll(){var c=this.currentTextIndex,d=this.currentWordIndex;if(!this.wordWin){alert("Error: Word frame not available.");return false}var e=this.wordWin.getTextVal(c,d);if(!e){alert('Error: "Not in dictionary" text is missing');return false}var g=this.controlWin.replacementText;if(!g.value)return false;var f=new String(g.value);this._setWordText(c,d,f,this.replAllFlag);for(var a=c;a<this.wordWin.textInputs.length;a++)for(var b=0;b<this.wordWin.totalWords(a);b++)if(a==c&&b>d||a>c)this.wordWin.getTextVal(a,b)==e&&!this.wordFlags[a][b]&&this._setWordText(a,b,f,this.fromReplAll);this.currentWordIndex++;this._spellcheck();return true}function terminateSpell(){var a="",b=this._getTotalReplaced();if(b==0)if(!this.wordWin)a="";else if(this.wordWin.totalMisspellings())a+=FCKLang.DlgSpellNoChanges;else a+=FCKLang.DlgSpellNoMispell;else if(b==1)a+=FCKLang.DlgSpellOneChange;else a+=FCKLang.DlgSpellManyChanges.replace(/%1/g,b);a&&alert(a);if(b>0)for(var c=0;c<this.textInputs.length;c++)if(this.wordWin)if(this.wordWin.textInputs[c])this.textInputs[c].value=this.wordWin.textInputs[c];typeof this.OnFinished=="function"&&this.OnFinished(b);return true}function undo(){var g=this.currentTextIndex,h=this.currentWordIndex;if(this.wordWin.totalPreviousWords(g,h)>0){this.wordWin.removeFocus(g,h);do if(this.currentWordIndex==0&&this.currentTextIndex>0){this.currentTextIndex--;this.currentWordIndex=this.wordWin.totalWords(this.currentTextIndex)-1;if(this.currentWordIndex<0)this.currentWordIndex=0}else if(this.currentWordIndex>0)this.currentWordIndex--;while(this.wordWin.totalWords(this.currentTextIndex)==0||this.wordFlags[this.currentTextIndex][this.currentWordIndex]==this.fromIgnrAll||this.wordFlags[this.currentTextIndex][this.currentWordIndex]==this.fromReplAll);var c=this.currentTextIndex,d=this.currentWordIndex,f=this.wordWin.originalSpellings[c][d];this.wordWin.totalPreviousWords(c,d)==0&&this.controlWin.disableUndo();var a,b,e;switch(this.wordFlags[c][d]){case this.replAllFlag:for(a=c;a<this.wordWin.textInputs.length;a++)for(b=0;b<this.wordWin.totalWords(a);b++)if(a==c&&b>=d||a>c){e=this.wordWin.originalSpellings[a][b];e==f&&this._setWordText(a,b,e,undefined)}break;case this.ignrAllFlag:for(a=c;a<this.wordWin.textInputs.length;a++)for(b=0;b<this.wordWin.totalWords(a);b++)if(a==c&&b>=d||a>c){e=this.wordWin.originalSpellings[a][b];if(e==f)this.wordFlags[a][b]=undefined}break;case this.replWordFlag:this._setWordText(c,d,f,undefined)}this.wordFlags[c][d]=undefined;this._spellcheck()}}function _spellcheck(){var a=this.wordWin;if(this.currentWordIndex==a.totalWords(this.currentTextIndex)){this.currentTextIndex++;this.currentWordIndex=0;if(this.currentTextIndex<this.wordWin.textInputs.length){this._spellcheck();return}else{this.terminateSpell();return}}this.currentWordIndex>0&&this.controlWin.enableUndo();if(this.wordFlags[this.currentTextIndex][this.currentWordIndex]){this.currentWordIndex++;this._spellcheck()}else{var b=a.getTextVal(this.currentTextIndex,this.currentWordIndex);if(b){this.controlWin.evaluatedText.value=b;a.setFocus(this.currentTextIndex,this.currentWordIndex);this._getSuggestions(this.currentTextIndex,this.currentWordIndex)}}}function _getSuggestions(c,d){this.controlWin.clearSuggestions();var a=this.wordWin.suggestions[c][d];if(a)for(var b=0;b<a.length;b++)this.controlWin.addSuggestion(a[b]);this.controlWin.selectDefaultSuggestion()}function _setAsIgnored(a,b,c){this.wordWin.removeFocus(a,b);this.wordFlags[a][b]=c;return true}function _getTotalReplaced(){for(var c=0,a=0;a<this.wordFlags.length;a++)for(var b=0;b<this.wordFlags[a].length;b++)if(this.wordFlags[a][b]==this.replWordFlag||this.wordFlags[a][b]==this.replAllFlag||this.wordFlags[a][b]==this.fromReplAll)c++;return c}function _setWordText(a,b,c,d){this.wordWin.setText(a,b,c);this.wordFlags[a][b]=d;return true}function _getFormInputs(d){for(var c=[],a=0;a<document.forms.length;a++)for(var b=0;b<document.forms[a].elements.length;b++)if(document.forms[a].elements[b].type.match(d))c[c.length]=document.forms[a].elements[b];return c};