FCKCommands.RegisterCommand("Placeholder",new FCKDialogCommand("Placeholder",FCKLang.PlaceholderDlgTitle,FCKPlugins.Items.placeholder.Path+"fck_placeholder.html",340,160));var oPlaceholderItem=new FCKToolbarButton("Placeholder",FCKLang.PlaceholderBtn);oPlaceholderItem.IconPath=FCKPlugins.Items.placeholder.Path+"placeholder.gif";FCKToolbarItems.RegisterItem("Placeholder",oPlaceholderItem);var FCKPlaceholders={};FCKPlaceholders.Add=function(b){var a=FCK.InsertElement("span");this.SetupSpan(a,b)};FCKPlaceholders.SetupSpan=function(a,b){a.innerHTML="[[ "+b+" ]]";a.style.backgroundColor="#ffff00";a.style.color="#000000";if(FCKBrowserInfo.IsGecko)a.style.cursor="default";a._fckplaceholder=b;a.contentEditable=false;a.onresizestart=function(){FCK.EditorWindow.event.returnValue=false;return false}};FCKPlaceholders._SetupClickListener=function(){FCKPlaceholders._ClickListener=function(a){a.target.tagName=="SPAN"&&a.target._fckplaceholder&&FCKSelection.SelectNode(a.target)};FCK.EditorDocument.addEventListener("click",FCKPlaceholders._ClickListener,true)};FCKPlaceholders.OnDoubleClick=function(a){a.tagName=="SPAN"&&a._fckplaceholder&&FCKCommands.GetCommand("Placeholder").Execute()};FCK.RegisterDoubleClickHandler(FCKPlaceholders.OnDoubleClick,"SPAN");FCKPlaceholders.Exist=function(c){for(var b=FCK.EditorDocument.getElementsByTagName("SPAN"),a=0;a<b.length;a++)if(b[a]._fckplaceholder==c)return true;return false};if(FCKBrowserInfo.IsIE)FCKPlaceholders.Redraw=function(){if(FCK.EditMode!=FCK_EDITMODE_WYSIWYG)return;var a=FCK.EditorDocument.body.innerText.match(/\[\[[^\[\]]+\]\]/g);if(!a)return;for(var c=FCK.EditorDocument.body.createTextRange(),b=0;b<a.length;b++)if(c.findText(a[b])){var d=a[b].match(/\[\[\s*([^\]]*?)\s*\]\]/)[1];c.pasteHTML('<span style="color: #000000; background-color: #ffff00" contenteditable="false" _fckplaceholder="'+d+'">'+a[b]+"</span>")}};else{FCKPlaceholders.Redraw=function(){if(FCK.EditMode!=FCK_EDITMODE_WYSIWYG)return;var f=FCK.EditorDocument.createTreeWalker(FCK.EditorDocument.body,NodeFilter.SHOW_TEXT,FCKPlaceholders._AcceptNode,true),a=[];while(oNode=f.nextNode())a[a.length]=oNode;for(var b=0;b<a.length;b++){for(var d=a[b].nodeValue.split(/(\[\[[^\[\]]+\]\])/g),c=0;c<d.length;c++)if(d[c].length>0)if(d[c].indexOf("[[")==0){var g=d[c].match(/\[\[\s*([^\]]*?)\s*\]\]/)[1],e=FCK.EditorDocument.createElement("span");FCKPlaceholders.SetupSpan(e,g);a[b].parentNode.insertBefore(e,a[b])}else a[b].parentNode.insertBefore(FCK.EditorDocument.createTextNode(d[c]),a[b]);a[b].parentNode.removeChild(a[b])}FCKPlaceholders._SetupClickListener()};FCKPlaceholders._AcceptNode=function(a){return/\[\[[^\[\]]+\]\]/.test(a.nodeValue)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}}FCK.Events.AttachEvent("OnAfterSetHTML",FCKPlaceholders.Redraw);FCKXHtml.TagProcessors.span=function(b,a){if(a._fckplaceholder)b=FCKXHtml.XML.createTextNode("[["+a._fckplaceholder+"]]");else FCKXHtml._AppendChildNodes(b,a,false);return b};